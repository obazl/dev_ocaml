---
layout: page_opam_ug
---

== bootstrap cmd: @opam//here/install

Simple wrapper to install OPAM packages into OBazl 'here' switch.

WARNING: Sometimes OPAM installations do not install everything they
should. Case in point: ounit2 and dune-configurator. You might need to explicitly
install the latter.

=== case 0: help

.Action: @opam//here/install -- -h
[%collapsible]
====
----
$ bazel run @opam//here/init -- -h
...
Usage: bazel run @opam//here/init -- [args]
	args:
		-c	compiler version
		-s	switch name
		-x	dry-run
		-d	debug
		-v	verbose
	Default: uses compiler version listed in .obazl.d/here.compiler
        if found; otherwise prompts user.
----
====


=== case 1:

.Initial conditions: `@opam//here/init` has been run
[%collapsible]
====
----
$ bazel run @opam//here/status
...
----
====

.Action: install
[%collapsible]
====
----
$ bazel run @opam//here/install -- -p ounit2
...
Begining OPAM processor output:
The following actions will be performed:
  ‚àó install seq          base  [required by ounit2]
  ‚àó install ocamlfind    1.9.3 [required by base-bytes]
  ‚àó install dune         3.0.3 [required by ounit2]
  ‚àó install base-bytes   base  [required by ounit2]
  ‚àó install stdlib-shims 0.3.0 [required by ounit2]
  ‚àó install ounit2       2.2.6
===== ‚àó 6 =====

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><>  üê´
‚¨á retrieved ounit2.2.2.6  (https://opam.ocaml.org/cache)
‚àó installed seq.base
‚¨á retrieved ocamlfind.1.9.3  (https://opam.ocaml.org/cache)
‚¨á retrieved stdlib-shims.0.3.0  (https://opam.ocaml.org/cache)
‚¨á retrieved dune.3.0.3  (https://opam.ocaml.org/cache)
‚àó installed ocamlfind.1.9.3
‚àó installed base-bytes.base
‚àó installed dune.3.0.3
‚àó installed stdlib-shims.0.3.0
‚àó installed ounit2.2.2.6
Done.
----
====


.Post-install status
[%collapsible]
====

----
<projroot>$ bazel run @opam//here/status
...
@opam//here/status
	root:   .opam
	switch: here
Begining OPAM processor output:
prefix   <projroot>/.opam/here
lib      <projroot>/.opam/here/lib
bin      <projroot>/.opam/here/bin
sbin     <projroot>/.opam/here/sbin
share    <projroot>/.opam/here/share
doc      <projroot>/.opam/here/doc
etc      <projroot>/.opam/here/etc
man      <projroot>/.opam/here/man
toplevel <projroot>/.opam/here/lib/toplevel
stublibs <projroot>/.opam/here/lib/stublibs
user     <user id>
group    <grp name>
Begining OPAM processor output:
# Packages matching: installed
# Name                # Version
base-bigarray         base
base-bytes            base
base-threads          base
base-unix             base
dune                  3.0.3
ocaml                 4.13.0
ocaml-base-compiler   4.13.0
ocaml-config          2
ocaml-options-vanilla 1
ocamlfind             1.9.3
ounit2                2.2.6
seq                   base
stdlib-shims          0.3.0
WORKSPACEs:
toolchain: .obazl.d/opam/here/ocaml
	stublibs
	bin
	WORKSPACE.bazel
	bigarray
	compiler-libs
	unix
	threads
	str
	c_api
	toolchains
	dynlink
----
====

.Action: config
[%collapsible]
====
----
$ bazel run @opam//here/config
...
Begining OPAM processor output:
The following actions will be performed:
  ‚àó install seq          base  [required by ounit2]
  ‚àó install ocamlfind    1.9.3 [required by base-bytes]
  ‚àó install dune         3.0.3 [required by ounit2]
  ‚àó install base-bytes   base  [required by ounit2]
  ‚àó install stdlib-shims 0.3.0 [required by ounit2]
  ‚àó install ounit2       2.2.6
===== ‚àó 6 =====

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><>  üê´
‚¨á retrieved ounit2.2.2.6  (https://opam.ocaml.org/cache)
‚àó installed seq.base
‚¨á retrieved ocamlfind.1.9.3  (https://opam.ocaml.org/cache)
‚¨á retrieved stdlib-shims.0.3.0  (https://opam.ocaml.org/cache)
‚¨á retrieved dune.3.0.3  (https://opam.ocaml.org/cache)
‚àó installed ocamlfind.1.9.3
‚àó installed base-bytes.base
‚àó installed dune.3.0.3
‚àó installed stdlib-shims.0.3.0
‚àó installed ounit2.2.2.6
Done.
----
====


=== case 4: prior installation

.Initial conditions
[%collapsible]
====
----
<projroot> $ bazel run @opam//here/status
...
@opam//here/status
	root:   .opam
	switch: here
Begining OPAM processor output:
prefix   <projroot>/.opam/here
lib      <projroot>/.opam/here/lib
bin      <projroot>/.opam/here/bin
sbin     <projroot>/.opam/here/sbin
share    <projroot>/.opam/here/share
doc      <projroot>/.opam/here/doc
etc      <projroot>/.opam/here/etc
man      <projroot>/.opam/here/man
toplevel <projroot>/.opam/here/lib/toplevel
stublibs <projroot>/.opam/here/lib/stublibs
user     <user id>
group    <grp name>
Begining OPAM processor output:
# Packages matching: installed
# Name                # Version
base-bigarray         base
base-threads          base
base-unix             base
ocaml                 4.13.0
ocaml-base-compiler   4.13.0
...
----
====

.Action: `$ bazel run @opam//here/init`
[%collapsible]
====
----
<projroot> $ bazel run @opam//here/init
OPAM here-switch already configured at root ./.opam, switch 'here', compiler: '4.13.0'.
Replace? [yN] N
cancelling here-switch init

<projroot> $ bazel run @opam//here/init
OPAM here-switch already configured at root ./.opam, switch 'here', compiler: '4.13.0'.
Replace? [yN] y
removing ./.opam
Your here switch is configured to use compiler version: 4.13.0 (specified in .obazl.d/opam/here.compiler)
Reconfigure using with same version? (if no, you will be prompted for a different version)
[Yn] n
Current OPAM switch name is '4.13.0', configured with compiler version 4.13.0
Configure here-switch with compiler version 4.13.0? [Yn] n
Which compiler version do you want to install? (<enter> to cancel) 4.11.0
Begining OPAM processor output:
No configuration file found, using built-in defaults.

<><> Fetching repository information ><><><><><><><><><><><><><><><><><><><>
[default] Initialised
Begining OPAM processor output:

<><> Installing new switch packages <><><><><><><><><><><><><><><><><><><><>  üê´
Switch invariant: ["ocaml-base-compiler" {= "4.11.0"} | "ocaml-system" {= "4.11.0"}]

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><>  üê´
‚àó installed base-bigarray.base
‚àó installed base-threads.base
‚àó installed base-unix.base
‚¨á retrieved ocaml-base-compiler.4.11.0  (https://opam.ocaml.org/cache)
‚àó installed ocaml-base-compiler.4.11.0
‚àó installed ocaml-config.1
‚àó installed ocaml.4.11.0
Done.
----
====


.Postcondition status
[%collapsible]
====

----
$ bazel run @opam//here/status
...
@opam//here/status
	root:   .opam
	switch: here
Begining OPAM processor output:
prefix   <projroot>/.opam/here
lib      <projroot>/.opam/here/lib
bin      <projroot>/.opam/here/bin
sbin     <projroot>/.opam/here/sbin
share    <projroot>/.opam/here/share
doc      <projroot>/.opam/here/doc
etc      <projroot>/.opam/here/etc
man      <projroot>/.opam/here/man
toplevel <projroot>/.opam/here/lib/toplevel
stublibs <projroot>/.opam/here/lib/stublibs
user     <user id>
group    <grp name>
Begining OPAM processor output:
# Packages matching: installed
# Name              # Version
base-bigarray       base
base-threads        base
base-unix           base
ocaml               4.11.0
ocaml-base-compiler 4.11.0
ocaml-config        1
----
====
