<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content="formatting,  notes, tips, cautions, warnings, admonitions">
<title>cc deps | The OBazl Book B</title>
<!-- <link rel="stylesheet" href="/css/syntax.css"> -->

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="/docs_obazl/css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="/docs_obazl/css/customstyles.css">
<link rel="stylesheet" href="/docs_obazl/css/boxshadowproperties.css">
<!-- most color styles are extracted out to here -->
<link rel="stylesheet" href="/docs_obazl/css/theme-blue.css">
<link rel="stylesheet" href="/docs_obazl/css/asciidoc.css">
<link rel="stylesheet" href="/docs_obazl/css/asciidoc-pygments.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="/docs_obazl/js/jquery.navgoco.min.js"></script>


<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.0/anchor.min.js"></script>
<!-- <script src="/docs_obazl/js/toc.js"></script> -->
<script src="/docs_obazl/js/customscripts.js"></script>

<link rel="shortcut icon" href="/docs_obazlimages/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="The OBazl Book" href="/feed.xml">



    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="/docs_obazl">&nbsp;<span class="projectTitle"> The OBazl Book</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <!-- <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li> -->
                <!-- entries without drop-downs appear here -->




                <!--  -->
                <!--  -->
                <!--  -->
                <!-- <li><a href="https://github.com/tomjoht/documentation-theme-jekyll" target="_blank" rel="noopener">GitHub</a></li> -->
                <!--  -->
                <!--  -->
                <!--  -->
                <!-- <li><a href="news">News</a></li> -->
                <!--  -->
                <!--  -->
                <!--  -->
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                <!--  -->
                <!--  -->
                <!-- <li class="dropdown"> -->
                <!--     <a href="#" class="dropdown-toggle" data-toggle="dropdown">Jekyll Help<b class="caret"></b></a> -->
                <!--     <ul class="dropdown-menu"> -->
                <!--          -->
                <!--          -->
                <!--         <li><a href="https://talk.jekyllrb.com" target="_blank" rel="noopener">Jekyll Talk</a></li> -->
                <!--          -->
                <!--          -->
                <!--          -->
                <!--         <li><a href="http://jekyllrb.com/docs/home/" target="_blank" rel="noopener">Jekyll documentation</a></li> -->
                <!--          -->
                <!--          -->
                <!--          -->
                <!--         <li><a href="http://stackoverflow.com/questions/tagged/jekyll" target="_blank" rel="noopener">Jekyll on Stack Overflow</a></li> -->
                <!--          -->
                <!--          -->
                <!--          -->
                <!--         <li><a href="http://idratherbewriting.com/category-jekyll/" target="_blank" rel="noopener">Jekyll on my blog</a></li> -->
                <!--          -->
                <!--          -->
                <!--     </ul> -->
                <!-- </li> -->
                <!--  -->
                <!-- <li class="dropdown"> -->
                <!--     <a href="#" class="dropdown-toggle" data-toggle="dropdown">Products<b class="caret"></b></a> -->
                <!--     <ul class="dropdown-menu"> -->
                <!--          -->
                <!--          -->
                <!--         <li><a href="mydoc_introduction.html">Jekyll Documentation Theme</a></li> -->
                <!--          -->
                <!--          -->
                <!--          -->
                <!--         <li><a href="p1_landing_page.html">Product 1</a></li> -->
                <!--          -->
                <!--          -->
                <!--          -->
                <!--         <li><a href="p2_landing_page.html">Product 2</a></li> -->
                <!--          -->
                <!--          -->
                <!--     </ul> -->
                <!-- </li> -->
                <!--  -->
                <!--  -->
                
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="/docs_obazl/js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: '/docs_obazl/search.json',
                                searchResultTemplate: '<li><a href="{url}" title="cc deps">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>



<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                


<ul id="mysidebar" class="nav">
  <li class="sidebarTitle">
    <a href="">
      
      
      rules_ocaml
    </a>
  </li>
  
      <!-- if you aren't using the accordion, uncomment this block: -->
         <!-- <p class="external"> -->
         <!--     <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a> -->
         <!-- </p> -->
         <!-- -->
</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>



            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
          <h1>cc deps
          <span id="timestamp">Last updated June 30, 2022</span>
          </h1>
    <!-- { % unless page.toc == false %} -->
    <!-- { % include toc.html %} -->
    <!-- { % endunless %} -->

            <div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_ccinfo-provider">CcInfo Provider</a>
<ul class="sectlevel2">
<li><a href="#_compilation_context">compilation_context</a></li>
<li><a href="#_linking_context">linking_context</a></li>
</ul>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_ccinfo-provider">CcInfo Provider</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://bazel.build/rules/lib/CcInfo#CcInfo">CcInfo</a> contains only two fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>compilation_context</code></p>
</li>
<li>
<p><code>linking_context</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>but both are complex and effectively undocumented.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Based on experimentation it looks like a cc_binary used to
produce a shared lib will <strong>not</strong> put its output into the
linking_context of a CcInfo provider. It does provide it in the
DefaultInfo.  Also in runfiles?
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_compilation_context">compilation_context</h3>
<div class="paragraph">
<p><a href="https://bazel.build/rules/lib/CompilationContext">CompilationContext</a></p>
</div>
<div class="paragraph">
<p>CompilationContext contains the headers and "local defines" used to
compile whatever is in the linking_context.</p>
</div>
</div>
<div class="sect2">
<h3 id="_linking_context">linking_context</h3>
<div class="literalblock">
<div class="content">
<pre>linking_ctx type: `CcLinkingContext`</pre>
</div>
</div>
<div class="paragraph">
<p>Fields: ["go_link_c_archive", "linker_inputs", "linkstamps"]</p>
</div>
<div class="paragraph">
<p><code>linker_inputs</code> is a list of <code>CcLinkingContext$LinkerInput</code>, evidently <a href="https://bazel.build/rules/lib/LinkerInput">LinkerInput</a>.</p>
</div>
<div class="paragraph">
<p><code>CcLinkingContext$LinkerInput</code> Fields:   ["additional_inputs", "libraries", "linkstamps", "owner", "user_link_flags"]</p>
</div>
<div class="paragraph">
<p>We&#8217;re interested in the <code>libraries</code> field, a list of <code>AutoValue_LibraryToLink_AutoLibraryToLink</code>.  Apparently this is a <a href="https://bazel.build/rules/lib/LibraryToLink">LibraryToLink</a>.</p>
</div>
<div class="paragraph">
<p>Fields of library-to-link:  ["alwayslink", "dynamic_library", "interface_library", "lto_bitcode_files", "must_keep_debug", "objects", "pic_lto_bitcode_files", "pic_objects", "pic_shared_non_lto_backends", "pic_static_library", "resolved_symlink_dynamic_library", "resolved_symlink_interface_library", "shared_non_lto_backends", "static_library"]</p>
</div>
<div class="paragraph">
<p>An example of what a library-to-link looks like. This was delivered by a <code>cc_library</code> target hat depends on the OCaml C SDK (<code>@ocaml//c</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  lib[0][0].alwayslink == None
  lib[0][0].dynamic_library == None
  lib[0][0].interface_library == None
  lib[0][0].lto_bitcode_files == None
  lib[0][0].must_keep_debug: &lt;built-in method must_keep_debug of LibraryToLink value&gt;
  lib[0][0].objects: [&lt;generated file interop/ffi/case110/cclibs/_objs/libalpha/alpha_adapter.o&gt;, &lt;generated file interop/ffi/case110/cclibs/_objs/libalpha/alpha.o&gt;]
  lib[0][0].pic_lto_bitcode_files == None
  lib[0][0].pic_objects == None
  lib[0][0].pic_shared_non_lto_backends: &lt;built-in method pic_shared_non_lto_backends of LibraryToLink value&gt;
  lib[0][0].pic_static_library == None
  lib[0][0].resolved_symlink_dynamic_library == None
  lib[0][0].resolved_symlink_interface_library == None
  lib[0][0].shared_non_lto_backends: &lt;built-in method shared_non_lto_backends of LibraryToLink value&gt;
  lib[0][0].static_library: &lt;generated file interop/ffi/case110/cclibs/liblibalpha.a&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This is the first lib in the first linkerinput.</p>
</div>
<div class="paragraph">
<p>This has both a <code>static_library</code> and a list of <code>objects</code>, which tells
us that the library was produced by rule (rather than a precompiled
imported library).</p>
</div>
<div class="paragraph">
<p>In this case, it is the first LinkerInput in linker_inputs; the second
LinkerInput contains (in this case) 13 libraries; they are the
libraries in the OCaml C SDK dependency of the rule.</p>
</div>
<div class="paragraph">
<p>In managing CC deps, we only want to retain direct dependencies. In
this case, that is the first LinkerInput. The other LinkerInputs were
only needed to produce the first. We do not need to retain them for
OCaml linking.</p>
</div>
</div>
</div>
</div>
        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>


