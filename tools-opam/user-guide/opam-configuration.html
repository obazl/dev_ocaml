<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content="opamconfiguration,  notes, tips, cautions, warnings, admonitions">
<title>OPAM Configuration | The OBazl Book B</title>
<!-- <link rel="stylesheet" href="/css/syntax.css"> -->

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="/docs_obazl/css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="/docs_obazl/css/customstyles.css">
<link rel="stylesheet" href="/docs_obazl/css/boxshadowproperties.css">
<!-- most color styles are extracted out to here -->
<link rel="stylesheet" href="/docs_obazl/css/theme-blue.css">
<link rel="stylesheet" href="/docs_obazl/css/asciidoc.css">
<link rel="stylesheet" href="/docs_obazl/css/asciidoc-pygments.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="/docs_obazl/js/jquery.navgoco.min.js"></script>


<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.0/anchor.min.js"></script>
<!-- <script src="/docs_obazl/js/toc.js"></script> -->
<script src="/docs_obazl/js/customscripts.js"></script>

<link rel="shortcut icon" href="/docs_obazlimages/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="The OBazl Book" href="/feed.xml">



    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: true, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="/docs_obazl">&nbsp;<span class="projectTitle"> The OBazl Book</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <!-- <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li> -->
                <!-- entries without drop-downs appear here -->




                <!--  -->
                <!--  -->
                <!--  -->
                <!-- <li><a href="https://github.com/tomjoht/documentation-theme-jekyll" target="_blank" rel="noopener">GitHub</a></li> -->
                <!--  -->
                <!--  -->
                <!--  -->
                <!-- <li><a href="news">News</a></li> -->
                <!--  -->
                <!--  -->
                <!--  -->
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                <!--  -->
                <!--  -->
                <!-- <li class="dropdown"> -->
                <!--     <a href="#" class="dropdown-toggle" data-toggle="dropdown">Jekyll Help<b class="caret"></b></a> -->
                <!--     <ul class="dropdown-menu"> -->
                <!--          -->
                <!--          -->
                <!--         <li><a href="https://talk.jekyllrb.com" target="_blank" rel="noopener">Jekyll Talk</a></li> -->
                <!--          -->
                <!--          -->
                <!--          -->
                <!--         <li><a href="http://jekyllrb.com/docs/home/" target="_blank" rel="noopener">Jekyll documentation</a></li> -->
                <!--          -->
                <!--          -->
                <!--          -->
                <!--         <li><a href="http://stackoverflow.com/questions/tagged/jekyll" target="_blank" rel="noopener">Jekyll on Stack Overflow</a></li> -->
                <!--          -->
                <!--          -->
                <!--          -->
                <!--         <li><a href="http://idratherbewriting.com/category-jekyll/" target="_blank" rel="noopener">Jekyll on my blog</a></li> -->
                <!--          -->
                <!--          -->
                <!--     </ul> -->
                <!-- </li> -->
                <!--  -->
                <!-- <li class="dropdown"> -->
                <!--     <a href="#" class="dropdown-toggle" data-toggle="dropdown">Products<b class="caret"></b></a> -->
                <!--     <ul class="dropdown-menu"> -->
                <!--          -->
                <!--          -->
                <!--         <li><a href="mydoc_introduction.html">Jekyll Documentation Theme</a></li> -->
                <!--          -->
                <!--          -->
                <!--          -->
                <!--         <li><a href="p1_landing_page.html">Product 1</a></li> -->
                <!--          -->
                <!--          -->
                <!--          -->
                <!--         <li><a href="p2_landing_page.html">Product 2</a></li> -->
                <!--          -->
                <!--          -->
                <!--     </ul> -->
                <!-- </li> -->
                <!--  -->
                <!--  -->
                
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="/docs_obazl/js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: '/docs_obazl/search.json',
                                searchResultTemplate: '<li><a href="{url}" title="OPAM Configuration">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>



<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                


<ul id="mysidebar" class="nav">
  <li class="sidebarTitle">
    <a href="/docs_obazl/tools-opam/user-guide">
      Guide:
      
      
      tools_opam
    </a>
  </li>
  
  
  
  <li>
    <a class="folder"
       title="Topics" href="#">Topics</a>
      <ul class="navlist">
          
          
          
          <li class="sb-navitem"><a title="Coswitches" href="coswitches">Coswitches</a></li>
          
          
          
          
          
          
          <li class="sb-navitem"><a title="Configuration" href="opam-configuration.html">Configuration</a></li>
          
          
          
          
      </ul>
   </li>
     
      
      
      <!-- if you aren't using the accordion, uncomment this block: -->
         <!-- <p class="external"> -->
         <!--     <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a> -->
         <!-- </p> -->
         <!-- -->
</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>



            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
          <h1>OPAM Configuration</h1>
    <!-- { % unless page.toc == false %} -->
    <!-- { % include toc.html %} -->
    <!-- { % endunless %} -->

            <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_system-switches">System Switches</a></li>
<li><a href="#_local-switches">Local Switches</a>
<ul class="sectlevel2">
<li><a href="#_compiler-build-variants">Compiler build variants</a></li>
</ul>
</li>
<li><a href="#_here-switches">Here switches</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>OBazl supports three kinds of OPAM switch configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>System switch - installed by default in <code>$(HOME)/.opam</code></p>
<div class="ulist">
<ul>
<li>
<p>Switches are named, user can specify the name</p>
</li>
</ul>
</div>
</li>
<li>
<p>Local switch - installed in <code>_opam</code>, a subdirectory of a specified directory, usually <code>$(PWD)</code></p>
<div class="ulist">
<ul>
<li>
<p>The installation directory containing <code>_opam</code> is treated as the name of the switch</p>
</li>
<li>
<p>Local switches use information in the system OPAM root <code>~/.opam</code>, e.g. <code>~/.opam/repo</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Here switch -  installed in <code>&lt;projroot&gt;/.opam</code></p>
<div class="ulist">
<ul>
<li>
<p>TODO: make it <code>&lt;projroot&gt;/.obazl.d/_opam</code></p>
</li>
<li>
<p>Here switch initialization also creates an OPAM root, so they are
independent of the system OPAM root</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>All three may be used as the basis of a project&#8217;s OBazl coswitch.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_system-switches">System Switches</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_local-switches">Local Switches</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://opam.ocaml.org/blog/opam-local-switches/">OPAM Local Switches</a></p>
</div>
<div class="paragraph">
<p>A "local switch" is an OPAM switch whose name is a directory
path; usually this will be the working directory <code>./</code> (which OPAM will
expand to an absolute path). The switch itself is located in the
<code>./_opam</code> subdirectory. OPAM commands detect the presence of <code>./_opam</code>
and automatically set it as the current switch.</p>
</div>
<div class="paragraph">
<p>Cmd: <code>$ opam create . --packages &lt;pkg1&gt;,&lt;pkg2&gt;&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>This creates a switch in the global OPAM installation (default
location: <code>$HOME/.opam</code>), named <code>$(PWD)</code> and located at
<code>$(PWD)/_opam</code>. To see the expanded switch name, run <code>$ opam switch
show</code>.</p>
</div>
<div class="paragraph">
<p>OBazl can be configured to use a local directory switch as a project
<code>here-coswitch</code>; see
<a href="/tools-opam/user-guide/here-configuration">Here-coswitch
configuration</a> and
<a href="/tools-opam/reference/here-create">@opam//here:create</a> for more
information.</p>
</div>
<div class="sect2">
<h3 id="_compiler-build-variants">Compiler build variants</h3>
<div class="paragraph">
<p>The OCaml compiler(s) are available in several <em>buld variants</em>, which are
controlled by build options. For example, to use the
<a href="https://v2.ocaml.org/manual/flambda.html">flamba</a> optimizers, you
must build the compilers with the <code>-flambda</code> configuration option.</p>
</div>
<div class="paragraph">
<p>Under OPAM these build variations are exposed as installable "option
packages", which will ensure that the compilers are built with the
appropriate configuration options. They can be enabled via the
following protocol:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>install the <code>+options</code> version of the compiler, e.g.
<code>ocaml-variants.4.14.0+options</code> instead of <code>ocaml-base-compiler.4.14.0</code></p>
</li>
<li>
<p>install the desired option package, e.g. <code>ocaml-option-flambda</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To list the available compiler packages, run</p>
</div>
<details>
<summary class="title"><code>$ opam switch list-available</code></summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code><span></span>$ opam switch list-available
# Listing available compilers from repositories: default
# Name                                 # Version                              # Synopsis
ocaml-option-32bit                     1                                      Set OCaml to be compiled in 32-bit mode for 64-bit Linux and OS X hosts
ocaml-option-afl                       1                                      Set OCaml to be compiled with afl-fuzz instrumentation
.
.
.
ocaml-base-compiler                    4.14.0~alpha1                          First alpha release of OCaml 4.14.0
ocaml-variants                         4.14.0~alpha1+options                  First alpha release of OCaml 4.14.0
ocaml-base-compiler                    4.14.0~alpha2                          Second alpha release of OCaml 4.14.0
ocaml-variants                         4.14.0~alpha2+options                  Second alpha release of OCaml 4.14.0
ocaml-base-compiler                    4.14.0~beta1                           First beta release of OCaml 4.14.0
ocaml-variants                         4.14.0~beta1+options                   First beta release of OCaml 4.14.0
ocaml-base-compiler                    4.14.0~rc1                             First release candidate of OCaml 4.14.0
ocaml-variants                         4.14.0~rc1+options                     First release candidate of OCaml 4.14.0
ocaml-base-compiler                    4.14.0~rc2                             Second release candidate of OCaml 4.14.0
ocaml-variants                         4.14.0~rc2+options                     Second release candidate of OCaml 4.14.0
ocaml-base-compiler                    4.14.0                                 Official release 4.14.0
ocaml-variants                         4.14.0+options                         Official release of OCaml 4.14.0
ocaml-variants                         4.14.1+trunk                           Latest 4.14.1 development
ocaml-variants                         5.0.0+trunk                            Current trunk</code></pre>
</div>
</div>
</div>
</details>
<div class="paragraph">
<p>To list the available option packages, run</p>
</div>
<details>
<summary class="title"><code>$ opam search ocaml-option</code></summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code><span></span>$ opam search ocaml-option
# Packages matching: match(*ocaml-option*)
# Name                                 # Installed # Synopsis
ocaml-option-32bit                     --          Set OCaml to be compiled in 32-bit mode for 64-bit Linux and OS X hosts
ocaml-option-afl                       --          Set OCaml to be compiled with afl-fuzz instrumentation
ocaml-option-bytecode-only             --          Compile OCaml without the native-code compiler
ocaml-option-default-unsafe-string     --          Set OCaml to be compiled without safe strings by default
ocaml-option-flambda                   --          Set OCaml to be compiled with flambda activated
ocaml-option-fp                        --          Set OCaml to be compiled with frame-pointers enabled
ocaml-option-musl                      --          Set OCaml to be compiled with musl-gcc
ocaml-option-nnp                       --          Set OCaml to be compiled with --disable-naked-pointers
ocaml-option-nnpchecker                --          Set OCaml to be compiled with --enable-naked-pointers-checker
ocaml-option-no-flat-float-array       --          Set OCaml to be compiled with --disable-flat-float-array
ocaml-option-spacetime                 --          Set OCaml to be compiled with spacetime activated
ocaml-option-static                    --          Set OCaml to be compiled with musl-gcc -static
ocaml-options-only-afl                 --          Ensure that OCaml is compiled with AFL support enabled, and no other custom options
ocaml-options-only-flambda             --          Ensure that OCaml is compiled with flambda activated, and no other custom options
ocaml-options-only-flambda-fp          --          Ensure that OCaml is compiled with flambda and frame-pointer enabled, and no other custom options
ocaml-options-only-fp                  --          Ensure that OCaml is compiled with only frame-pointer enabled, and no other custom options
ocaml-options-only-nnp                 --          Ensure that OCaml is compiled with no-naked-pointers, and no other custom options
ocaml-options-only-nnpchecker          --          Ensure that OCaml is compiled with enable-naked-pointers-checker, and no other custom options
ocaml-options-only-no-flat-float-array --          Ensure that OCaml is compiled with no-flat-float-array, and no other custom options
ocaml-options-vanilla                  1           Ensure that OCaml is compiled with no special options enabled</code></pre>
</div>
</div>
</div>
</details>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>install compiler version 4.14.0 with flambda support: <code>opam switch create . --packages=ocaml-variants.4.14.0+options,ocaml-option-flambda</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="https://discuss.ocaml.org/t/experimental-new-layout-for-the-ocaml-variants-packages-in-opam-repository/6779">Experimental new layout for the ocaml-variants packages in opam-repository</a> for more information.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_here-switches">Here switches</h2>
<div class="sectionbody">

</div>
</div>
        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>


